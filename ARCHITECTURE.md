# üèóÔ∏è Shader Maker - Process-Based Architecture

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —à–µ–π–¥–µ—Ä–æ–≤ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ —Å –ø–æ–ª–Ω—ã–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.

## üóÉÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã

#### `shader_processes`
–û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:
```sql
CREATE TABLE shader_processes (
  id TEXT PRIMARY KEY,
  prompt TEXT NOT NULL,
  status TEXT NOT NULL,
  current_step TEXT,
  config TEXT NOT NULL,
  result TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  completed_at TIMESTAMP
);
```

#### `process_steps`
–®–∞–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞:
```sql
CREATE TABLE process_steps (
  id TEXT PRIMARY KEY,
  process_id TEXT NOT NULL,
  type TEXT NOT NULL,
  status TEXT NOT NULL,
  input TEXT,
  output TEXT,
  error TEXT,
  started_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  completed_at TIMESTAMP,
  duration INTEGER,
  FOREIGN KEY (process_id) REFERENCES shader_processes (id)
);
```

#### `process_updates`
–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
```sql
CREATE TABLE process_updates (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  process_id TEXT NOT NULL,
  status TEXT NOT NULL,
  current_step TEXT,
  step_progress TEXT,
  new_step_id TEXT,
  result TEXT,
  error TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (process_id) REFERENCES shader_processes (id)
);
```

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–æ—Ü–µ—Å—Å–∞

### –°—Ç–∞—Ç—É—Å—ã –ø—Ä–æ—Ü–µ—Å—Å–∞
- `created` - –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω
- `generating` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —à–µ–π–¥–µ—Ä–∞
- `capturing` - –û–∂–∏–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
- `evaluating` - –û—Ü–µ–Ω–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- `improving` - –£–ª—É—á—à–µ–Ω–∏–µ –∫–æ–¥–∞
- `fixing` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫
- `completed` - –ó–∞–≤–µ—Ä—à–µ–Ω
- `failed` - –û—à–∏–±–∫–∞
- `paused` - –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

### –¢–∏–ø—ã —à–∞–≥–æ–≤
- `generation` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —à–µ–π–¥–µ—Ä–∞ –ø–æ –ø—Ä–æ–º–ø—Ç—É
- `capture` - –ó–∞—Ö–≤–∞—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
- `evaluation` - –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –ò–ò
- `improvement` - –£–ª—É—á—à–µ–Ω–∏–µ –∫–æ–¥–∞
- `fix` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
- `completion` - –§–∏–Ω–∞–ª—å–Ω—ã–π —à–∞–≥

### –ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```mermaid
graph TD
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å] --> B[–°—Ç–∞—Ç—É—Å: created]
    B --> C[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —à–µ–π–¥–µ—Ä–∞]
    C --> D[–°—Ç–∞—Ç—É—Å: capturing]
    D --> E[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç—ã]
    E --> F[–û—Ü–µ–Ω–∫–∞ –ò–ò]
    F --> G{–û—Ü–µ–Ω–∫–∞ >= 80?}
    G -->|–î–∞| H[–°—Ç–∞—Ç—É—Å: completed]
    G -->|–ù–µ—Ç| I{–ò—Ç–µ—Ä–∞—Ü–∏–π < –º–∞–∫—Å–∏–º—É–º–∞?}
    I -->|–î–∞| J[–£–ª—É—á—à–µ–Ω–∏–µ –∫–æ–¥–∞]
    I -->|–ù–µ—Ç| H
    J --> D
```

## üöÄ API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏

#### `POST /api/processes/start`
–ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
```typescript
{
  prompt: string;
  config?: {
    maxIterations?: number;
    targetScore?: number;
    autoMode?: boolean;
  };
}
```

#### `GET /api/processes/{id}`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
```typescript
// Response
{
  process: ShaderProcess;
  updates: ProcessUpdate[];
}
```

#### `POST /api/processes/{id}`
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–º
```typescript
{
  action: 'pause' | 'resume' | 'stop' | 'retry';
}
```

#### `POST /api/processes/{id}/screenshots`
–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
```typescript
{
  stepId: string;
  screenshots: string[];
}
```

#### `DELETE /api/processes/{id}`
–£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞

#### `GET /api/processes`
–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

## üé£ Frontend Hook

### `useProcess(options)`

```typescript
const {
  // –°–æ—Å—Ç–æ—è–Ω–∏–µ
  process,
  updates,
  isLoading,
  error,
  
  // –î–µ–π—Å—Ç–≤–∏—è
  startProcess,
  controlProcess,
  submitScreenshots,
  refreshProcess,
  deleteProcess,
  
  // –•–µ–ª–ø–µ—Ä—ã
  getCurrentCode,
  getCurrentStep,
  getLatestScore,
  isWaitingForScreenshots
} = useProcess({
  processId: 'some-id',
  autoRefresh: true,
  refreshInterval: 2000
});
```

## üîß ProcessRunner

–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ:

### –ú–µ—Ç–æ–¥—ã

- `startProcess(request)` - –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞
- `executeProcess(id)` - –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —à–∞–≥–æ–≤
- `submitScreenshots(id, stepId, screenshots)` - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
- `pauseProcess(id)` - –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞
- `resumeProcess(id)` - –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- `stopProcess(id)` - –û—Å—Ç–∞–Ω–æ–≤–∫–∞

### –®–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. **Generation Step** - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ —á–µ—Ä–µ–∑ OpenAI
2. **Capture Step** - –û–∂–∏–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –æ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
3. **Evaluation Step** - –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —á–µ—Ä–µ–∑ OpenAI
4. **Improvement Step** - –£–ª—É—á—à–µ–Ω–∏–µ –∫–æ–¥–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
5. **Completion** - –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

## üîÑ Real-time Updates

–°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ polling:

1. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
2. –ü–µ—Ä–µ–¥–∞–µ—Ç—Å—è `since` –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö updates
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∞—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å, —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –Ω–æ–≤—ã–µ —à–∞–≥–∏

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- –ü–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –ë–î
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
- –ñ—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —à–∞–≥–æ–≤

### ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å  
- –ü—Ä–æ—Ü–µ—Å—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- –û—á–µ—Ä–µ–¥–∏ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã (–±—É–¥—É—â–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ)

### ‚úÖ –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
- Real-time —Å—Ç–∞—Ç—É—Å –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å
- –ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –æ—à–∏–±–æ–∫

### ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å
- –ü–∞—É–∑–∞/–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- –†—É—á–Ω–æ–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º—ã
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### ‚úÖ UX
- –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –ü–æ–∫–∞–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –û—á–µ—Ä–µ–¥–∏ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
- Redis –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π
- –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏

### WebSocket/SSE
- –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –±–µ–∑ polling
- –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö—ç—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ—Ü–µ–Ω–∫–∏
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è OpenAI –∑–∞–ø—Ä–æ—Å–æ–≤
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –ú–µ—Ç—Ä–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ 